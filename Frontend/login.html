<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/aos.css">
    <link rel="stylesheet" href="css/ionicons.min.css">
    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/jquery.timepicker.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/icomoon.css">
    <link rel="stylesheet" href="css/style.css">

    <style type="text/css">
        body {
            color: #6F8BA4;
            margin-top: 20px;
        }

        .section {
            padding: 90px 0;
            position: relative;
        }

        .gray-bg {
            background-color: #f5f5f5;
        }

        img {
            max-width: 100%;
        }

        img {
            vertical-align: middle;
            border-style: none;
        }

        .form-container {
            border: 1px solid #ced4da;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
        }

        .form-group input {
            border: none;
            border-bottom: 1px solid #ced4da;
            outline: none;
            padding: 5px 0;
            font-size: 14px;
        }

        .form-group label {
            margin-bottom: 5px;
        }

        .center-submit {
            display: flex;
            justify-content: center;
        }

        .form-control {
            border: none;
            outline: none;
            font-size: 14px;
            border-bottom: 1px solid #ced4da;
        }

        #signupForm {
            display: none;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const sessionActive = sessionStorage.getItem('sessionActive');

            if (sessionActive === 'true') {

                document.getElementById('restricted-content').style.display = 'block';
            }
            else if (sessionActive === 'false') {

                window.location.href = 'login.html';
                
            }    
        });
    </script>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light"
        style="padding: 0 20px 0 20px;" id="ftco-navbar">
        <a class="navbar-brand" href="index.html">
            <img src="images/logo.png" alt="NutriSafe Logo" style="width: 80px; height: auto;">
            NutriSafe
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav"
            aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="oi oi-menu"></span> Menu
        </button>
        <div class="collapse navbar-collapse" id="ftco-nav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active"><a href="index.html" class="nav-link" onclick="return false;">Home</a></li>
                <li class="nav-item"><a href="about.html" class="nav-link" onclick="return false;">About</a></li>
                <li class="nav-item"><a href="community.html" class="nav-link" onclick="return false;">Community</a>
                </li>
                <li class="nav-item"><a href="blog.html" class="nav-link" onclick="return false;">Stores</a></li>
                <li class="nav-item"><a href="contact.html" class="nav-link" onclick="return false;">Contact</a></li>
                <li class="nav-item"><a href="profile.html" class="nav-link" onclick="return false;">Profile</a></li>
                <li class="nav-item cta cta-colored"><a href="wishlist.html" class="nav-link"
                        onclick="return false;"><span class="icon-shopping_cart"></span>[0]</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false" onclick="return false;">
                        User
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" style="color: red; font-size: 12px;"
                                onclick="return false;">LogOut</a>
                        </li>
                        <li><a class="dropdown-item" href="update.html" style="font-size: 12px;"
                                onclick="return false;">Update
                                Info</a></li>
                        <li><a class="dropdown-item" href="add.html" style="font-size: 12px;"
                                onclick="return false;">ADD</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>
    <section class="ftco-section img" style="background-image: url(images/update.avif); height: 340px">
        <div class="container">
            <div class="row justify-content-start" style="color:rgb(0, 0, 0); font-size: 15px; font-weight:500;">
                <div class="col-md-6 heading-section ftco-animate deal-of-the-day ftco-animate">
                    <h2 class="mb-4" style="color:wheat;">Login to Continue..</h2>
                    <br>

                    <div style="display: flex; align-items: center; margin-top: 20px;">
                        <img src="images/logo.png" alt="Logo" style="width: 100px; height: auto;">
                        <span style="font-size: 24px; margin-left: 10px; color: wheat;;">NUTRISAFE</span>
                    </div>

                </div>
            </div>
        </div>
    </section>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6 form-container" id="loginForm">
                <form id="loginFormElement">
                    <div class="form-group">
                        <label for="loginUsername">Username:</label>
                        <input type="text" class="form-control" id="loginUsername" placeholder="Enter your username">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password:</label>
                        <input type="password" class="form-control" id="loginPassword"
                            placeholder="Enter your password">
                    </div>
                    <hr>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">Login</button>
                    </div>
                    <span id="login-error" class="error-message"></span>
                </form>
                <p class="text-center">Don't have an account? <a href="#" onclick="toggleForm()">Sign Up</a></p>
            </div>

            <div class="col-md-6 form-container" id="signupForm">
                <form id="signupFormElement">
                    <div class="form-group">
                        <label for="fullname">Full Name:</label>
                        <input type="text" class="form-control" id="fullname" placeholder="Enter your full name">
                        <span id="fullname-error" class="error-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="signupEmail">Email:</label>
                        <input type="email" class="form-control" id="signupEmail" placeholder="Enter your email">
                        <span id="email-error" class="error-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="signupUsername">Username:</label>
                        <input type="text" class="form-control" id="signupUsername" placeholder="Enter your user name">
                        <span id="username-error" class="error-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password:</label>
                        <input type="password" class="form-control" id="signupPassword"
                            placeholder="Enter your password">
                        <span id="password-error" class="error-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password:</label>
                        <input type="password" class="form-control" id="confirmPassword"
                            placeholder="Confirm your password">
                        <span id="confirm-password-error" class="error-message"></span>
                    </div>
                    <hr>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">Sign Up</button>
                    </div>
                </form>
                <p class="text-center">Already have an account? <a href="#" onclick="toggleForm()">Login</a></p>
            </div>
        </div>
    </div>
    <footer class="ftco-footer ftco-section img">
        <div class="container">
            <div class="row mb-5">
                <div class="col-md">
                    <div class="ftco-footer-widget mb-4">
                        <h2 class="ftco-heading-2">NutriSafe</h2>
                        <p>Finding healthy ingredients is now simple. Connect with local farmers and stores for the best
                            quality products.</p>
                        <ul class="ftco-footer-social list-unstyled float-md-left float-lft mt-5">
                            <li class="ftco-animate"><a href="#" onclick="return false;"><span
                                        class="icon-twitter"></span></a></li>
                            <li class="ftco-animate"><a href="#" onclick="return false;"><span
                                        class="icon-facebook"></span></a></li>
                            <li class="ftco-animate"><a href="#" onclick="return false;"><span
                                        class="icon-instagram"></span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md">
                    <div class="ftco-footer-widget mb-4">
                        <h2 class="ftco-heading-2">Support</h2>
                        <ul class="list-unstyled">
                            <li><a href="#" class="py-2 d-block" onclick="return false;">Contact Us</a></li>
                            <li><a href="#" class="py-2 d-block" onclick="return false;">FAQs</a></li>
                            <li><a href="#" class="py-2 d-block" onclick="return false;">Shipping Information</a></li>
                            <li><a href="#" class="py-2 d-block" onclick="return false;">Returns & Exchanges</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md">
                    <div class="ftco-footer-widget mb-4">
                        <h2 class="ftco-heading-2">Quick Links</h2>
                        <ul class="list-unstyled">
                            <li><a href="#" class="py-2 d-block" onclick="return false;">About Us</a></li>
                            <li><a href="#" class="py-2 d-block" onclick="return false;">Community</a></li>
                            <li><a href="#" class="py-2 d-block" onclick="return false;">Stores</a></li>
                            <li><a href="#" class="py-2 d-block" onclick="return false;">Blog</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md">
                    <div class="ftco-footer-widget mb-4">
                        <h2 class="ftco-heading-2">Have Questions?</h2>
                        <div class="block-23 mb-3">
                            <ul>
                                <li><span class="icon icon-map-marker"></span><span class="text">203 Fake St. Mountain
                                        View, San Francisco, California, USA</span></li>
                                <li><a href="#" onclick="return false;"><span class="icon icon-phone"></span><span
                                            class="text">+2 392 3929 210</span></a></li>
                                <li><a href="#" onclick="return false;"><span class="icon icon-envelope"></span><span
                                            class="text">info@yourdomain.com</span></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 text-center">
                    <p>Copyright &copy;
                        <script>
                            document.write(new Date().getFullYear());
                        </script> All rights reserved | This template is made with <i class="icon-heart color-danger"
                            aria-hidden="true"></i> by <a href="#" onclick="return false;" target="_blank">NutriSafe</a>
                    </p>
                </div>
            </div>
        </div>
    </footer>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/scrollax.min.js"></script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
    <script src="js/google-map.js"></script>
    <script src="js/main.js"></script>
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            // Retrieve session data
            const username = sessionStorage.getItem('username');
            const userId = sessionStorage.getItem('id');

            // Debugging statement to verify session data
            console.log('Session Data:', { username, userId });

            if (username && userId) {
                console.log('Session exists, redirecting to index.html');
                window.location.href = 'index.html';
            } else {
                // Session does not exist, show the login form
                const loginForm = document.getElementById('loginForm');
                const signupForm = document.getElementById('signupForm');

                if (loginForm) {
                    loginForm.style.display = 'block'; // Show login form
                }
                if (signupForm) {
                    signupForm.style.display = 'none'; // Hide signup form initially
                }
            }
        });
        function toggleForm() {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            if (loginForm.style.display === 'none') {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
            }
        }

        document.getElementById('loginForm').addEventListener('submit', validateLoginForm);

        async function validateLoginForm(event) {
            event.preventDefault(); // Prevent default form submission

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch('http://localhost:3000/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    console.log('Login successful:', data);

                    if (!sessionStorage.getItem('username') && !sessionStorage.getItem('id')) {

                        sessionStorage.setItem('username', data.username);
                        sessionStorage.setItem('id', data.id);

                    }

                    // Redirect to another pag
                    window.location.href = 'index.html';
                } else {
                    console.error('Login failed:', data);
                    alert(data.message || 'Login failed');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
        document.getElementById('signupForm').addEventListener('submit', function (event) {
            event.preventDefault();
            validateSignupForm();
        });

        function validateSignupForm() {
            let isValid = true;
            const fullname = document.getElementById('fullname').value;
            const email = document.getElementById('signupEmail').value;
            const username = document.getElementById('signupUsername').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            const fullnameError = document.getElementById('fullname-error');
            const emailError = document.getElementById('email-error');
            const usernameError = document.getElementById('username-error');
            const passwordError = document.getElementById('password-error');
            const confirmPasswordError = document.getElementById('confirm-password-error');

            fullnameError.textContent = '';
            emailError.textContent = '';
            usernameError.textContent = '';
            passwordError.textContent = '';
            confirmPasswordError.textContent = '';

            if (!fullname) {
                fullnameError.textContent = 'Full name is required';
                isValid = false;
            }

            if (!email) {
                emailError.textContent = 'Email is required';
                isValid = false;
            } else if (!validateEmail(email)) {
                emailError.textContent = 'Invalid email format';
                isValid = false;
            }

            if (!username) {
                usernameError.textContent = 'User name is required';
                isValid = false;
            }

            if (!password) {
                passwordError.textContent = 'Password is required';
                isValid = false;
            } else if (password.length < 6) {
                passwordError.textContent = 'Password must be at least 6 characters long';
                isValid = false;
            }

            if (!confirmPassword) {
                confirmPasswordError.textContent = 'Confirm password is required';
                isValid = false;
            } else if (confirmPassword !== password) {
                confirmPasswordError.textContent = 'Passwords do not match';
                isValid = false;
            }

            if (isValid) {
                const formData = {
                    fullname: fullname,
                    username: username,
                    email: email,
                    password: password
                };

                fetch('http://localhost:3000/api/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                })
                    .then(response => response.text()) // Get response as text
                    .then(text => {
                        try {
                            const data = JSON.parse(text); // Parse text to JSON
                            if (data.success) {
                                alert('Sign up successful!');
                                toggleForm(); // Toggle back to the login form
                                // Optionally clear the signup form
                                document.getElementById('signupFormElement').reset();
                            } else {
                                alert('Sign up failed: ' + data.message);
                            }
                        } catch (error) {
                            console.error('Failed to parse JSON:', error);
                            alert('An error occurred. Please try again.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred. Please try again.');
                    });
            }
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

    </script>
</body>

</html>